SELECT machine_id, ROUND(AVG(process_time), 3) AS processing_time
FROM(
    SELECT machine_id,
    process_id,
    activity_type,
    timestamp,
    MAX(CASE WHEN activity_type = 'end' THEN timestamp END)
    - MIN(CASE WHEN activity_type = 'start' THEN timestamp END) as process_time
    from Activity
    GROUP BY machine_id, process_id
)t
GROUP BY machine_id;
